@using MyHebrewBible.Client.Features.FavoriteVerses
@using Blazored.Typeahead

@* @inject ILogger<Typeahead>? Logger *@

<BlazoredTypeahead SearchMethod="SearchContent"
									 TValue="Enums.Verse"
									 TItem="Enums.Verse"
									 Value="SelectedVerse"
									 ValueChanged="SelectedResultChanged"
									 ValueExpression="@(() => SelectedVerse)"
									 MaximumSuggestions="200"
									 MinimumLength="1"
									 EnableDropDown="true">
	<SelectedTemplate Context="mycontext">
		@mycontext!.VerseNameAbrv
	</SelectedTemplate>
	<ResultTemplate Context="mycontext">
		@mycontext.VerseName
	</ResultTemplate>
</BlazoredTypeahead>


@code {
	[Parameter, EditorRequired] public EventCallback<Enums.Verse> OnVerseSelected { get; set; }

	private Enums.Verse? SelectedVerse;

	private async Task<IEnumerable<Enums.Verse>> SearchContent(string searchText)
	{
		return await Task.FromResult(Enums.Verse.List
			.Where(x => x.VerseNameAbrv.ToLower().Contains(searchText.ToLower()))
			.OrderBy(o => o.Value));
	}

	private void SelectedResultChanged(Enums.Verse verse)
	{
		//Logger!.LogInformation("{Method}, Verse: {Verse}", nameof(SelectedResultChanged), verse.VerseName);
		OnVerseSelected.InvokeAsync(verse);
	}
}