@page "/Haggadah"

@using MyHebrewBible.Client.Features.Haggadah.Enums
@using MyHebrewBible.Client.Features.Haggadah.Toolbar
@using Page = MyHebrewBible.Client.Enums.Nav

<PageTitle>@Page.Haggadah.Title</PageTitle>

<NavbarHaggadah Section="Section"
OnMenuItemSelected="ReturnedMenuItem"
OnSectionSelected="ReturnedSection" />

<LoadingProgress>
	<div class="mt-5">
		@if (CurrentContent is not null)
		{
			<ContentSkeleton Content=CurrentContent Language="Language">
				<EngBody>
					@foreach (var detailEng in Enums.ContentDetail.List
															.Where(w => w.ParentId == CurrentContent!.Value)
															.OrderBy(o => o.Value).ToList())
					{
						@detailEng.EngBody
					}
				</EngBody>

				<EspBody>
					@foreach (var detailEsp in Enums.ContentDetail.List
															.Where(w => w.ParentId == CurrentContent!.Value)
															.OrderBy(o => o.Value).ToList())
					{
						@detailEsp.EspBody
					}
				</EspBody>

			</ContentSkeleton>
		}
		else
		{
			<div class="card border-danger mb-3 mt-5">
				<div class="card-body text-center fs-1">No Haggadah Section Found <br /> (◡︵◡)</div>
			</div>
		}
	</div>

</LoadingProgress>

@code {
	[CascadingParameter] public CascadingAppState? State { get; set; }

	protected int Section;

	protected Enums.Content? CurrentContent;

	protected Enums.DisplayLanguage? Language;

	protected override void OnInitialized()
	{
		Language = GetLanguageState();
		Section = 1;
		CurrentContent = Enums.Content.List.FirstOrDefault(w => w.Value == Section);
	}

	protected string Test()
	{
		return "";
		/*
		return VerseParagraph.Jeremiah3131to33(DisplayLanguage.English,
	31,"Behold, days are coming,” declares Yehovah, “when I will cut a renewed covenant with the house of Israel and with the house of Judah,",
	32, " not like the covenant which I cut with their fathers in the day I took them by the hand to bring them out of the land of Egypt, My covenant which they broke, but I was a husband to them,” declares Yehovah. ",
	33, " “But this is the covenant which I will cut with the house of Israel after those days,” declares Yehovah: “I will put My law within them, and on their heart I will write it; and I will be their God, and they shall be My people”."
		};
		*/
	}

	private Enums.DisplayLanguage GetLanguageState()
	{
		int id = State!.AppState!.HaggadahState!.Get();

		Enums.DisplayLanguage? _language;
		if (Enums.DisplayLanguage.TryFromValue(id, out _language))
		{
			return Enums.DisplayLanguage.FromValue(id);
		}
		else
		{
			return Enums.DisplayLanguage.English;
		}
	}

	private async Task ReturnedMenuItem(Enums.DisplayLanguage item)
	{
		Language = item;
		await State!.AppState!.HaggadahState!.UpdateLanguage(item);
	}

	private void ReturnedSection(int section)
	{
		Section = section;
		CurrentContent = Enums.Content.List.FirstOrDefault(w => w.Value == Section);
		// save to local storage
	}

}
